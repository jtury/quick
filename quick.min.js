// Â©2021 James Tury. Licensed under the MIT license. Contribute at https://github.com/jtury/quick
"use strict";let httpRequest,cache=[],tagName="main";const parser=new DOMParser;function fetch_information(e){let t=cache.findIndex(i=>i[0].includes(e)),n=!1;if(t===-1){if(e.slice(-5)!=".html"&&(n=!0,e+="/index.html"),httpRequest=new XMLHttpRequest,!httpRequest)return!1;httpRequest.onreadystatechange=function(){if(httpRequest.readyState===XMLHttpRequest.DONE)if(httpRequest.status===200){let i;n?i=httpRequest.responseURL.replace("index.html",""):i=httpRequest.responseURL,cache.push([i,{title:parser.parseFromString(httpRequest.responseText,"text/html").getElementsByTagName("title")[0].innerHTML,page_content:parser.parseFromString(httpRequest.responseText,"text/html").getElementsByTagName(tagName)[0].innerHTML}])}else return!1},httpRequest.open("GET",e),httpRequest.send()}return!0}function special_keys(e){return e.shiftKey||e.ctrlKey||e.altKey||e.metaKey}function attach_hooks(){Array.from(document.getElementsByTagName("a")).forEach(t=>{t.href&&new URL(t.href).origin===location.origin&&(t.addEventListener("pointerenter",function(){setTimeout(function(){t.matches(":hover")&&fetch_information(t.href)},85)}),t.addEventListener("pointerdown",function(n){special_keys(n)||(n.preventDefault(),fetch_information(t.href))}),t.addEventListener("click",function(n){if(!special_keys(n))if(n.preventDefault(),fetch_information(t.href)===!0){let i=t.href;display_page(cache.findIndex(r=>r[0].includes(i)))}else window.location=t.href}))})}function display_page(e){let t=cache[e][0],n=cache[e][1].title,i=cache[e][1].page_content;document.title=n,document.getElementsByTagName(tagName)[0].innerHTML=i,window.history.pushState({title:n,html:i},n,t)}window.onpopstate=function(e){let t=JSON.stringify(e.state);t!=="null"&&(t=JSON.parse(t),document.title=t.title,document.getElementsByTagName(tagName)[0].innerHTML=t.html,attach_hooks())},window.onload=function(){cache.push([document.location.href,{title:document.title,page_content:document.getElementsByTagName(tagName)[0].innerHTML}]);let t=cache[0][0],n=cache[0][1].title,i=cache[0][1].page_content;window.history.replaceState({title:n,html:i},n,t),attach_hooks()};